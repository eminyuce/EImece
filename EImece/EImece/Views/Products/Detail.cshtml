@model EImece.Domain.Models.FrontModels.ProductDetailViewModel
@using EImece.Domain.Entities;
@using EImece.Domain.Helpers.HtmlHelpers;
@using EImece.Domain.Helpers.Extensions;
@using EImece.Domain.Helpers;
@using EImece.Domain;
@using Resources;

@{
    var product = Model.Product;
    var isUserAuthenticated = User.Identity.IsAuthenticated && AppConfig.IsEditLinkEnable;
    ViewBag.Title = product.GetSeoTitle();
    ViewBag.Description = product.GetSeoDescription();
    ViewBag.Keywords = product.GetSeoKeywords();
    Layout = "~/Views/Shared/_Layout.cshtml";
    var productFiles = product.ProductFiles.ToList();
    var productTags = product.ProductTags.Select(r => r.Tag).ToList();
    var productCategory = product.ProductCategory;
    var productSpecs = product.ProductSpecifications;
    var relatedStories = Model.RelatedStories.OrderBy(x => Guid.NewGuid()).Take(1).ToList();
    var relatedProducts = Model.RelatedProducts.OrderBy(x => Guid.NewGuid()).Take(4).ToList();
    var productMainImageId = product.MainImageId.HasValue ? product.MainImageId.Value : 0;
    string[] numbersArr = new string[] { "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen" };
}

<!-- Page Title-->
<div class="page-title-wrapper" aria-label="Page title">
    <div class="container">
        @Html.Partial("_ProductBreadCrumb", Model)
        <h1 class="page-title">@product.Name</h1><span class="d-block mt-2 text-muted"></span>
        <hr class="mt-4">
    </div>
</div>
<!-- Page Content-->
<!-- Toast notifications-->
<div class="toast-container toast-bottom-center">
    <div class="toast mb-3" id="cart-toast" data-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="mr-2" data-feather="check-circle" style="width: 1.25rem; height: 1.25rem;"></i><span class="font-weight-semibold mr-auto">Added to cart!</span>
            <button class="close text-white ml-2 mb-1" type="button" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="toast-body">This item was added to your cart.</div>
    </div>
    <div class="toast mb-3" id="compare-toast" data-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-info text-white">
            <i class="mr-2" data-feather="info" style="width: 1.25rem; height: 1.25rem;"></i><span class="font-weight-semibold mr-auto">Added to comparison!</span>
            <button class="close text-white ml-2 mb-1" type="button" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="toast-body">This item was added to comparison table.</div>
    </div>
    <div class="toast mb-3" id="wishlist-toast" data-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-info text-white">
            <i class="mr-2" data-feather="info" style="width: 1.25rem; height: 1.25rem;"></i><span class="font-weight-semibold mr-auto">Added to wishlist!</span>
            <button class="close text-white ml-2 mb-1" type="button" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="toast-body">This item was added to your wishlist.</div>
    </div>
    <div class="toast mb-3" id="profile-toast" data-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="mr-2" data-feather="check-circle" style="width: 1.25rem; height: 1.25rem;"></i><span class="font-weight-semibold mr-auto">Updated!</span>
            <button class="close text-white ml-2 mb-1" type="button" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="toast-body">Your profile info updated successfuly.</div>
    </div>
    <div class="toast mb-3" id="address-toast" data-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="mr-2" data-feather="check-circle" style="width: 1.25rem; height: 1.25rem;"></i><span class="font-weight-semibold mr-auto">Updated!</span>
            <button class="close text-white ml-2 mb-1" type="button" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="toast-body">Your addresses info updated successfuly.</div>
    </div>
</div>
<input type="hidden" name="productId" id="productId" value="@product.Id">
<div class="container pb-4">
    <div class="row">
        <div class="col-lg-7">
            <!-- Product gallery-->
            <div class="product-gallery">
                <span class="badge badge-danger">Sale -30%</span>
                <ul class="product-thumbnails">
                    @if (product.ImageState)
                    {
                        var imgTag = product.GetCroppedImageUrl(productMainImageId, 95, 105);
                        <li class="active">
                            <a href="#one">
                                <img alt="Product thumb" src="@imgTag" />
                            </a>
                        </li>
                    }

                    @for (int i = 0; i < productFiles.Count; i++)
                    {
                        var f = productFiles[i];
                        var imgTag = product.GetCroppedImageUrl(f.FileStorageId, 95, 105);
                        <li class="">
                            <a href="@string.Format("#{0}",numbersArr[i])">
                                <img alt="Product thumb" src="@imgTag" />
                            </a>
                        </li>
                    }
                </ul>
                <div class="product-carousel owl-carousel">

                    @if (product.ImageState)
                    {
                        var imgTag = product.GetCroppedImageUrl(productMainImageId, 1000, 0);
                        <a href="@imgTag" data-fancybox="prod-gallery" data-hash="one">
                            <img src="@imgTag" alt="Product">
                        </a>

                    }

                    @for (int i = 0; i < productFiles.Count; i++)
                    {
                        var f = productFiles[i];
                        var imgTag = f.GetCroppedImageUrl(f.FileStorageId, 1000, 0);

                        <a href="@imgTag" data-fancybox="prod-gallery" data-hash="@string.Format("{0}",numbersArr[i])">
                            <img src="@imgTag" alt="Product">
                        </a>

                    }
                </div>
            </div>
        </div>
        <!-- Product details    -->
        <div class="col-lg-5 pt-4 pt-lg-0">
            <div class="pb-4">
                <h2 class="h1 font-weight-light pt-3 pb-2">
                    <del class="lead text-muted mr-2">@product.Price.CurrencySign()</del><span class="text-primary">@product.GetProductPrice().CurrencySign()</span>
                </h2>
                <div class="d-flex align-items-center pt-2">
                    <input class="px-2 form-control mr-2" id="quantity" type="number" name="quantity" style="width: 3.2rem;" value="1" required>
                    <button id="AddToCart" class="btn btn-primary btn-block" type="button" data-toggle="toast" data-target="#cart-toast"><i class="mr-2" data-feather="shopping-cart"></i>Add to cart</button>
                </div>
                <div class="d-flex flex-wrap align-items-center pt-3"><a class="btn box-shadow-0 nav-link-inline px-4 border-right" href="#" data-toggle="toast" data-target="#compare-toast"><i class="align-middle mr-1" data-feather="repeat" style="width: 1.1rem; height: 1.1rem;"></i>Compare</a><a class="btn box-shadow-0 nav-link-inline px-4" href="#" data-toggle="toast" data-target="#wishlist-toast"><i class="align-middle mr-1" data-feather="heart" style="width: 1.1rem; height: 1.1rem;"></i>Add to wishlist</a></div>
            </div>
            <!-- Product panels-->
            <div class="accordion" id="productPanels">
                <div class="card">
                    <div class="card-header">
                        <h3 class="accordion-heading"><a href="#productInfo" role="button" data-toggle="collapse" aria-expanded="true" aria-controls="productInfo"><span class="d-inline-block pr-2 border-right mr-2 align-middle mt-n1"><i data-feather="info" style="width: 1.1rem; height: 1.1rem;"></i></span>Product information<span class="accordion-indicator"><i data-feather="chevron-up"></i></span></a></h3>
                    </div>
                    <div class="collapse show" id="productInfo" data-parent="#productPanels">
                        <div class="card-body">
                            @if (!String.IsNullOrEmpty(product.ProductCode))
                            {
                                <span class="product-code">
                                    <i>
                                        @Resource.ProductCodeNo @product.ProductCode
                                    </i>
                                </span>
                                <br />
                            }
                            @Html.Raw(product.ShortDescription)
                            <ul class="mb-0">
                                <li><a class="scroll-to font-weight-semibold" href="#product-details">More info</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="accordion-heading">
                            <a class="collapsed" href="#tagCloud" role="button" data-toggle="collapse" aria-expanded="true" aria-controls="tagCloud">
                                <span class="d-inline-block pr-2 border-right mr-2 align-middle mt-n1">
                                    <i data-feather="tag" style="width: 1.1rem; height: 1.1rem;"></i>
                                </span>Tag cloud<span class="accordion-indicator">
                                    <i data-feather="chevron-up"></i>
                                </span>
                            </a>
                        </h3>
                    </div>
                    <div class="collapse" id="tagCloud" data-parent="#productPanels">
                        <div class="card-body">
                            @if (productTags.Count > 0)
                            {

                                foreach (var t in productTags)
                                {
                                    <a class="tag-link mr-2 mb-2" href="@Url.Action("Tag", "products", new { id = t.GetSeoUrl() })">@t.Name</a>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
            <!-- Share product-->
            <div class="py-4">
                <span class="d-inline-block align-middle font-size-sm mr-3 mb-2">
                    Share product:
                </span>
                <a class="social-btn sb-instagram mr-2 mb-2" href="@product.DetailPageAbsoluteUrl">
                    <i class="flaticon-instagram"></i>
                </a>
                <a class="social-btn sb-facebook mr-2 mb-2" href="@product.DetailPageAbsoluteUrl">
                    <i class="flaticon-facebook"></i>
                </a>
                <a class="social-btn sb-twitter mr-2 mb-2" href="http://twitter.com/share?text=@product.Name&url=@product.DetailPageAbsoluteUrl&hashtags=hashtag1,hashtag2,hashtag3">
                    <i class="flaticon-twitter"></i>
                </a>
                <a class="social-btn sb-pinterest mr-2 mb-2" href="@product.DetailPageAbsoluteUrl">
                    <i class="flaticon-pinterest"></i>
                </a>
            </div>
        </div>
    </div>
</div>
<!-- Product info-->
<div class="bg-secondary pt-5 pb-4" id="product-details" data-offset-top="-5">
    <div class="container pt-sm-3 pb-sm-3">
        <div class="row">
            <div class="col-md-6">
                <h3 class="h5 mb-3">Details</h3>
                <p class="mb-4 pb-2">@Html.Raw(product.Description)</p>
            </div>

            @if (Model.ProdSpecs.Count > 0)
            {

                <div class="col-md-6">
                    <h3 class="h5 mb-3">Specifications</h3>
                    @if (isUserAuthenticated)
                    {
                        @Html.ActionLink("edit specs", "saveoreditproductspecs", "Products", new { @id = product.Id, @area = "admin" }, new { @class = "adminPageLink", @target = "_blank" })
                    }
                    <ul class="list-unstyled mb-4 pb-2">
                        @foreach (KeyValuePair<string, string> entry in Model.ProdSpecs)
                        {
                            <li class="d-block pb-2 border-bottom"><strong>@entry.Key:</strong> @entry.Value</li>
                        }
                    </ul>
                </div>

            }
        </div>
    </div>
</div>

@if (relatedProducts.Any())
{
 
    <!-- Related products-->
    <div class="container pb-5">
        <h2 class="h3 pb-4">@Resource.SimilairProducts</h2>
        <div class="owl-carousel" data-owl-carousel="{ &quot;nav&quot;: false, &quot;dots&quot;: true, &quot;loop&quot;: true, &quot;margin&quot;: 15, &quot;responsive&quot;: {&quot;0&quot;:{&quot;items&quot;:1},&quot;360&quot;:{&quot;items&quot;:2}, &quot;630&quot;:{&quot;items&quot;:3}, &quot;850&quot;:{&quot;items&quot;:4}, &quot;1200&quot;:{&quot;items&quot;:5}} }">
            @foreach (var product2 in relatedProducts)
            {
                <div class="product-card">
                    <div class="product-thumb box-shadow-0">
                        <a class="product-thumb-link" href="@product2.DetailPageRelativeUrl">
                        </a><span class="product-wishlist-btn"
                                  data-toggle="tooltip"
                                  data-placement="left"
                                  title="Add to wishlist">
                            <i data-feather="heart"></i>
                        </span><img src="@product2.GetCroppedImageUrl(product2.MainImageId,50,0)" alt="Product">
                    </div>
                    <div class="product-card-body box-shadow-0">
                        <div class="d-flex flex-wrap justify-content-between pb-1">
                            <a class="product-meta" href="@product2.DetailPageRelativeUrl">@product2.Name</a>
                            <div class="star-rating"><span class="sr-label mr-1">4.7</span><i class="sr-star active" data-feather="star"></i></div>
                        </div>
                        <h3 class="product-card-title">
                            <a href="@product2.DetailPageRelativeUrl">
                                @product2.ShortDescription
                            </a>
                        </h3><span class="text-primary">@product2.GetProductPrice().CurrencySign()</span>
                    </div>
                </div>
            }
        </div>
    </div>

}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}